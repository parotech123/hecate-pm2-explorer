{"version":3,"file":"_server.ts-82eea018.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/remoteProcesses/_server.ts.js"],"sourcesContent":["import \"pm2\";\nimport \"read-last-lines\";\nimport \"os\";\nimport IpSubnetCalculator from \"ip-subnet-calculator\";\nimport axios from \"axios\";\nimport Bluebird from \"bluebird\";\nconst TIMEOUT = 100;\nconst GET = async ({ request, url }) => {\n  let subnet = url.searchParams.get(\"subnet\");\n  if (typeof subnet === \"undefined\")\n    return new Response(\"No subnet provided\", { status: 400 });\n  const allProcesses = [];\n  const ipRange = IpSubnetCalculator.calculateSubnetMask(subnet.split(\"/\")[0], Number(subnet.split(\"/\")[1]));\n  const ips = [];\n  for (let i = ipRange.ipLow; i <= ipRange.ipHigh; i++) {\n    ips.push(longToIp(i));\n  }\n  for (let i = 0; i < ips.length; i += 30) {\n    const batch = ips.slice(i, i + 30);\n    await Bluebird.map(batch, async (ip) => {\n      try {\n        const response = await axios.get(`http://${ip}:3000/api/processes`, { timeout: TIMEOUT });\n        if (response.status === 200) {\n          allProcesses.push({\n            ip,\n            processes: response.data.processes\n          });\n        }\n      } catch (error) {\n        console.error(`Failed to fetch processes from ${ip}:`, error.message);\n      }\n    }, { concurrency: 10 });\n  }\n  return new Response(JSON.stringify(allProcesses));\n};\nfunction longToIp(long) {\n  const buf = Buffer.alloc(4);\n  buf.writeUInt32BE(long);\n  return [\n    buf[0],\n    buf[1],\n    buf[2],\n    buf[3]\n  ].join(\".\");\n}\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;;;;;AAMA,MAAM,OAAO,GAAG,GAAG,CAAC;AACf,MAAC,GAAG,GAAG,OAAO,EAAE,OAAO,EAAE,GAAG,EAAE,KAAK;AACxC,EAAE,IAAI,MAAM,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;AAC9C,EAAE,IAAI,OAAO,MAAM,KAAK,WAAW;AACnC,IAAI,OAAO,IAAI,QAAQ,CAAC,oBAAoB,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC;AAC/D,EAAE,MAAM,YAAY,GAAG,EAAE,CAAC;AAC1B,EAAE,MAAM,OAAO,GAAG,kBAAkB,CAAC,mBAAmB,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAC7G,EAAE,MAAM,GAAG,GAAG,EAAE,CAAC;AACjB,EAAE,KAAK,IAAI,CAAC,GAAG,OAAO,CAAC,KAAK,EAAE,CAAC,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACxD,IAAI,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;AAC1B,GAAG;AACH,EAAE,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,EAAE;AAC3C,IAAI,MAAM,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC;AACvC,IAAI,MAAM,QAAQ,CAAC,GAAG,CAAC,KAAK,EAAE,OAAO,EAAE,KAAK;AAC5C,MAAM,IAAI;AACV,QAAQ,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,mBAAmB,CAAC,EAAE,EAAE,OAAO,EAAE,OAAO,EAAE,CAAC,CAAC;AAClG,QAAQ,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE;AACrC,UAAU,YAAY,CAAC,IAAI,CAAC;AAC5B,YAAY,EAAE;AACd,YAAY,SAAS,EAAE,QAAQ,CAAC,IAAI,CAAC,SAAS;AAC9C,WAAW,CAAC,CAAC;AACb,SAAS;AACT,OAAO,CAAC,OAAO,KAAK,EAAE;AACtB,QAAQ,OAAO,CAAC,KAAK,CAAC,CAAC,+BAA+B,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;AAC9E,OAAO;AACP,KAAK,EAAE,EAAE,WAAW,EAAE,EAAE,EAAE,CAAC,CAAC;AAC5B,GAAG;AACH,EAAE,OAAO,IAAI,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC,CAAC;AACpD,EAAE;AACF,SAAS,QAAQ,CAAC,IAAI,EAAE;AACxB,EAAE,MAAM,GAAG,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;AAC9B,EAAE,GAAG,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;AAC1B,EAAE,OAAO;AACT,IAAI,GAAG,CAAC,CAAC,CAAC;AACV,IAAI,GAAG,CAAC,CAAC,CAAC;AACV,IAAI,GAAG,CAAC,CAAC,CAAC;AACV,IAAI,GAAG,CAAC,CAAC,CAAC;AACV,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACd;;;;"}