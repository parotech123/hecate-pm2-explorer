{"version":3,"file":"PM2Wrapper-d4c04e93.js","sources":["../../../.svelte-kit/adapter-node/chunks/PM2Wrapper.js"],"sourcesContent":["import pm2 from \"pm2\";\nimport readLastLines from \"read-last-lines\";\nimport os from \"os\";\nimport { timer } from \"rxjs\";\nimport { switchMap } from \"rxjs/operators\";\nclass PM2Wrapper {\n  // Connect to PM2\n  async connect() {\n    return new Promise((resolve, reject) => {\n      pm2.connect((err) => {\n        if (err) {\n          console.error(err);\n          reject(err);\n        }\n        resolve();\n      });\n    });\n  }\n  // Disconnect from PM2\n  disconnect() {\n    pm2.disconnect();\n  }\n  // Start a new process\n  async start(options) {\n    return new Promise((resolve, reject) => {\n      pm2.start(options, (err, proc) => {\n        if (err) {\n          console.error(err);\n          reject(err);\n        }\n        resolve(proc);\n      });\n    });\n  }\n  // Stop a process\n  async stop(process) {\n    return new Promise((resolve, reject) => {\n      pm2.stop(process, (err) => {\n        if (err) {\n          console.error(err);\n          reject(err);\n        }\n        resolve();\n      });\n    });\n  }\n  // Restart a process\n  async restart(process) {\n    return new Promise((resolve, reject) => {\n      pm2.restart(process, (err) => {\n        if (err) {\n          console.error(err);\n          reject(err);\n        }\n        resolve();\n      });\n    });\n  }\n  // Delete a process\n  async delete(process) {\n    return new Promise((resolve, reject) => {\n      pm2.delete(process, (err) => {\n        if (err) {\n          console.error(err);\n          reject(err);\n        }\n        resolve();\n      });\n    });\n  }\n  // Retrieve last N lines of logs\n  async retrieveLastLines(process, lines, logType = \"out\") {\n    const processDescription = await this.describe(process);\n    const logFilePath = logType === \"out\" ? processDescription.pm2_env?.pm_out_log_path : processDescription.pm2_env?.pm_err_log_path;\n    if (!logFilePath) {\n      throw new Error(`${logType} log file path not found`);\n    }\n    return readLastLines.read(logFilePath, lines);\n  }\n  // Describe a process\n  async describe(process) {\n    return new Promise((resolve, reject) => {\n      pm2.describe(process, (err, processDescriptionList) => {\n        if (err) {\n          console.error(err);\n          reject(err);\n        }\n        const processDescription = processDescriptionList[0];\n        if (!processDescription) {\n          reject(new Error(`Process ${process} not found`));\n          return;\n        }\n        resolve(processDescription);\n      });\n    });\n  }\n  // Retrieve process list\n  async listProcesses() {\n    return new Promise((resolve, reject) => {\n      pm2.list((err, processDescriptionList) => {\n        if (err) {\n          console.error(err);\n          reject(err);\n        }\n        const processList = processDescriptionList.map((procDesc) => {\n          let data = {\n            name: procDesc.name,\n            pid: procDesc.pid,\n            memory: Number(procDesc.monit.memory),\n            cpu: procDesc.monit.cpu,\n            pm_id: procDesc.pm_id,\n            ip: this.getLocalIPAddress(),\n            istances: procDesc.pm2_env.instances,\n            outlogPath: procDesc.pm2_env.pm_out_log_path,\n            errlogPath: procDesc.pm2_env.pm_err_log_path,\n            pidPath: procDesc.pm2_env.pm_pid_path,\n            status: procDesc.pm2_env.status,\n            uptime: (/* @__PURE__ */ new Date()).getTime() - procDesc.pm2_env.created_at,\n            restarts: procDesc.pm2_env.restart_time,\n            unstableRestarts: procDesc.pm2_env.unstable_restarts,\n            version: procDesc.pm2_env.version,\n            nodeVersion: procDesc.pm2_env.node_version,\n            watch: procDesc.pm2_env.watch,\n            autorestart: procDesc.pm2_env.autorestart,\n            execMode: procDesc.pm2_env.exec_mode,\n            execInterpreteur: procDesc.pm2_env.exec_interpreter,\n            execPath: procDesc.pm2_env.pm_exec_path,\n            createdAt: procDesc.pm2_env.created_at\n          };\n          return data;\n        });\n        resolve(processList);\n      });\n    });\n  }\n  flushLogs(name) {\n    return new Promise((resolve, reject) => {\n      pm2.flush(name, (err) => {\n        if (err) {\n          reject(err);\n          return;\n        }\n        resolve();\n      });\n    });\n  }\n  getProcessDescriptionObservable(process, intervalMs = 1e3) {\n    return timer(0, intervalMs).pipe(\n      switchMap(() => new Promise((resolve) => resolve(this.describe(process))))\n    );\n  }\n  getLocalIPAddress() {\n    const interfaces = os.networkInterfaces();\n    for (const devName in interfaces) {\n      const iface = interfaces[devName];\n      for (let i = 0; i < iface.length; i++) {\n        const alias = iface[i];\n        if (alias.family === \"IPv4\" && alias.address !== \"127.0.0.1\" && !alias.internal) {\n          return alias.address;\n        }\n      }\n    }\n    return \"\";\n  }\n}\nexport {\n  PM2Wrapper as P\n};\n"],"names":[],"mappings":"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"}